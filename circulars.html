<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ClearCache | Circulars</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    .circulars-section { max-width: 900px; margin: 48px auto 32px; padding: 0 12px 32px; border-radius: 14px; background: var(--panel-bg,#f5f7fb); box-shadow: 0 2px 18px #0001; }
    .circulars-section h2 { font-size: 2rem; font-weight: 700; text-align: center; color: var(--primary,#134d72); margin: 0 0 6px; letter-spacing: 1px; }
    .exchange-title { font-size:1.35rem; font-weight: 800; color: var(--primary,#134d72); text-align:center; margin: 26px 0 8px; }
    .subnote { text-align:center; color:#667; margin:0 0 22px; font-size:.92rem; }
    .group-block { margin-bottom: 32px; }
    .group-title { color:#fff; background:#2e6da4; padding:10px 20px; border-radius:7px 7px 0 0; font-weight:700; }
    .circular { background:var(--card-bg,#fff); margin:0 0 13px; padding:15px 19px; border-radius:0 0 8px 8px; box-shadow:0 2px 7px #0001; border-left:5px solid #2e6da4; display:flex; flex-direction:column; gap:5px; }
    .circular-title { font-size:1.05em; font-weight:700; color:#2e6da4; }
    .circular-date  { color:#888; font-size:.95em; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace; }
    .circular-link  { color:#126118; text-decoration:underline; }
    .circular-desc  { font-size:.98em; color:var(--primary); }
    .empty { color:var(--primary,#134d72); font-style:italic; }
    .error { color:#c03232; }
    @media (max-width:600px){ .circulars-section{padding:7px;} .group-title{font-size:1em;padding:8px 6px;} .circulars-section h2{font-size:1.2em;} }
  </style>
</head>
<body>
  <header style="position:relative;">
    <h1>ClearCache</h1>
    <p class="tagline">Minimal digital workspace</p>
    <button id="theme-toggle" aria-label="Toggle light or dark theme"
      style="position:absolute;right:2.2rem;top:2.3rem;background:none;border:none;cursor:pointer;font-size:1.75rem;color:var(--primary);">
      ðŸŒ™
    </button>
  </header>

  <nav aria-label="Main navigation">
    <div class="nav-container">
      <a href="index.html" class="nav-item">Home</a>
      <a href="about.html" class="nav-item">About</a>
      <a href="circulars.html" class="nav-item active">Circulars</a>
      <a href="game.html" class="nav-item">Game</a>
    </div>
  </nav>

  <main>
    <section class="circulars-section">
      <h2>Exchange Circulars (Last 24 hours)</h2>
      <div id="nse-area">
        <div class="exchange-title">NSE</div>
        <p id="nse-window" class="subnote">Window: â€”</p>
        <div id="nse-feed" style="margin-bottom:24px;min-height:70px;">Loading NSEâ€¦</div>
      </div>
      <div id="bse-area">
        <div class="exchange-title">BSE</div>
        <p id="bse-window" class="subnote">Window: â€”</p>
        <div id="bse-feed" style="margin-bottom:24px;min-height:70px;">Loading BSEâ€¦</div>
      </div>
    </section>
  </main>

  <footer>
    <p>Â© ClearCache <span id="year"></span> | Venktezh</p>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Theme toggle
    (function(){
      function getPreferredTheme(){ const s=localStorage.getItem('theme'); if(s) return s;
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light'; }
      function setTheme(t){ document.documentElement.setAttribute('data-theme', t);
        localStorage.setItem('theme', t);
        const b=document.getElementById('theme-toggle');
        b.innerHTML = t==="dark" ? "ðŸŒž" : "ðŸŒ™";
        b.setAttribute('aria-label', t==="dark" ? "Switch to light theme":"Switch to dark theme"); }
      document.addEventListener('DOMContentLoaded',()=>{
        const btn=document.getElementById('theme-toggle'); if(!btn) return;
        let cur=getPreferredTheme(); setTheme(cur);
        btn.onclick=()=>{ cur=(cur==="dark"?"light":"dark"); setTheme(cur); };
      });
    })();

    // --------- Time helpers (IST window, no double-shift) ----------
    const IST_OFFSET_MIN = -330; // minutes (Date.getTimezoneOffset() convention)
    function toIST(date){
      const localOffsetMin = date.getTimezoneOffset(); // varies by user
      const deltaMin = IST_OFFSET_MIN - localOffsetMin;
      return new Date(date.getTime() + deltaMin*60*1000);
    }
    function formatIST(d){
      return d.toLocaleString("en-IN", {
        day:"2-digit", month:"short", year:"numeric",
        hour:"2-digit", minute:"2-digit", hour12:false
      }) + " IST";
    }
    function last24hISTWindow(){
      const nowIST = toIST(new Date());
      const startIST = new Date(nowIST.getTime() - 24*60*60*1000);
      return {startIST, nowIST};
    }
    function withinLast24hIST(pubUTC){
      const {startIST, nowIST} = last24hISTWindow();
      const pubIST = toIST(pubUTC);
      return pubIST >= startIST && pubIST <= nowIST;
    }
    function stripHTML(html){
      const div=document.createElement('div'); div.innerHTML=html||'';
      return (div.textContent||div.innerText||'').replace(/\s+/g,' ').trim();
    }
    function parseDateFlexible(s){
      if (!s) return null;
      const d = new Date(s);
      if (!isNaN(d)) return d;
      let m = s.match(/^(\d{1,2})[ -](\w{3})[ -](\d{4})(?:[ ,T]+(\d{1,2}):(\d{2}))?/i);
      if (m){
        const [ , dd, mon, yyyy, hh='00', mm='00' ] = m;
        const months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};
        const mi = months[mon.toLowerCase()];
        if (mi>=0) return new Date(Date.UTC(+yyyy, mi, +dd, +hh, +mm));
      }
      m = s.match(/^(\d{1,2})[\/-](\d{1,2})[\/-](\d{4})$/);
      if (m){
        const [ , dd, mm, yyyy ] = m;
        return new Date(Date.UTC(+yyyy, +mm-1, +dd, 0, 0));
      }
      return null;
    }

    
