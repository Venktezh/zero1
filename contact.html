<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Latest NSE Circulars</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f5f7; padding: 20px; }
    h2 { color: #1a3c6e; }
    input, button { padding: 5px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; }
    th { background: #1a3c6e; color: white; }
    .error { color: red; }
</style>
</head>
<body>

<h2>Latest NSE Circulars</h2>
<label>From: <input type="date" id="fromDate"></label>
<label>To: <input type="date" id="toDate"></label>
<input type="text" id="keyword" placeholder="Search keyword...">
<button onclick="fetchCirculars()">Search</button>

<p id="error" class="error"></p>
<table id="circularTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Title</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const API_URL = 'http://localhost:3000/api/circulars';

function formatDate(date) {
    return date.toISOString().split('T')[0];
}

async function fetchCirculars() {
    document.getElementById('error').textContent = '';
    const from = document.getElementById('fromDate').value;
    const to = document.getElementById('toDate').value;
    const keyword = document.getElementById('keyword').value;

    try {
        const res = await fetch(`${API_URL}?from=${from}&to=${to}&keyword=${encodeURIComponent(keyword)}`);
        if (!res.ok) throw new Error('Failed to fetch');
        const data = await res.json();

        const tbody = document.querySelector('#circularTable tbody');
        tbody.innerHTML = '';

        if (data && data.data && data.data.length > 0) {
            data.data.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.subject}</td>
                    <td><a href="${item.pdfLink}" target="_blank">PDF</a></td>
                `;
                tbody.appendChild(tr);
            });
        } else {
            tbody.innerHTML = '<tr><td colspan="3">No circulars found</td></tr>';
        }
    } catch (err) {
        document.getElementById('error').textContent = 'Error: ' + err.message;
    }
}

// Auto-load last 7 days data
document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    const lastWeek = new Date();
    lastWeek.setDate(today.getDate() - 7);

    document.getElementById('fromDate').value = formatDate(lastWeek);
    document.getElementById('toDate').value = formatDate(today);

    fetchCirculars();
});
</script>

</body>
</html>
