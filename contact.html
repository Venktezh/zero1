<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ClearCache | Minesweeper</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Uses the shared theme.css file for all common design/themes -->
    <link rel="stylesheet" href="theme.css">
    <!-- Game-specific (minimal) styles -->
    <style>
        .board { display: grid; gap:0; background: #cccccc; border-radius: 7px; border:2px solid #444; box-shadow: 0 1px 10px #0001;}
        .cell {
            width: 2em; height: 2em; text-align: center; vertical-align: middle;
            border: 1px solid #bbb; background: #e4e4e6;
            font-size: 1.25em; font-family: inherit;
            user-select: none; cursor: pointer;
            transition: background 0.13s, border 0.13s;
            padding: 0;
        }
        .cell.revealed { background: #fafcff; border-color: #aaa; cursor: default; }
        .cell.mine { background: #ecd6d8 !important; }
        .cell.flagged { background: #f9f4c0; color: #c0392b; }
        .cell:disabled { cursor: default; }
        .cell.mine.revealed { color: #c0392b; }
        .cell.mine.exploded {
            border: 3px solid red !important;
            box-sizing: border-box;
            background: #ffadad !important;
        }
        .num1 { color: #1a85e8;}
        .num2 { color: #3d990a;}
        .num3 { color: #e8a91a;}
        .num4 { color: #e2381a;}
        .num5 { color: #425969;}
        .num6 { color: #8774e3;}
        .num7 { color: #bb1ae8;}
        .num8 { color: #13191d;}
        #status { margin-top: 1.07em; font-weight: 500; min-height: 2em;}
        #mine-count { margin-left: 1.5em; font-weight: 700; color: #e2381a;}
        @media (max-width: 600px) {
            .board { border-radius: 3px;}
            .cell { width: 1.5em; height: 1.5em; }
        }
    </style>
</head>
<body>
<header style="position:relative;">
    <h1>ClearCache</h1>
    <p class="tagline">Minimal digital workspace</p>
    <!-- Theme toggle button (top-right, accessible) -->
    <button id="theme-toggle" aria-label="Toggle light or dark theme"
        style="position: absolute; right: 2.2rem; top: 2.3rem; background: none; border: none; cursor: pointer; font-size: 1.75rem; color: var(--primary); transition: color 0.2s;">
        ðŸŒ™
    </button>
</header>
<nav aria-label="Main navigation">
    <div class="nav-container">
        <a href="index.html" class="nav-item">Home</a>
        <a href="about.html" class="nav-item">About</a>
        <a href="contact.html" class="nav-item">Contact</a>
        <a href="game.html" class="nav-item active">Game</a>
    </div>
</nav>
<h2 class="center" style="margin-top:2em; color:var(--primary);">Minesweeper</h2>
<div id="mine-container">
    <div id="game-options" style="text-align:center;margin-bottom:1.2em;">
        <span>Level: Easy (9x9, 10 mines)</span>
        <button class="btn" onclick="newGame()">New Game</button>
        <span id="mine-count"></span>
    </div>
    <div id="board-wrap">
        <div id="board"></div>
    </div>
    <div id="status" class="center"></div>
</div>
<script>
const rows = 9, cols = 9, mines = 10;
let board = [], revealed = [], flagged = [];
let gameOver = false, started = false, minesLeft = mines;
let explodedCell = null;
function newGame() {
    board = Array.from({length: rows}, () => Array(cols).fill(0));
    revealed = Array.from({length: rows}, () => Array(cols).fill(false));
    flagged = Array.from({length: rows}, () => Array(cols).fill(false));
    gameOver = false;
    started = false;
    minesLeft = mines;
    explodedCell = null;
    document.getElementById('status').innerHTML = '';
    document.getElementById('mine-count').textContent = `ðŸ’£ ${minesLeft}`;
    drawBoard();
}
function drawBoard() {
    const boardDiv = document.getElementById('board');
    boardDiv.innerHTML = '';
    boardDiv.className = 'board';
    boardDiv.style.gridTemplateColumns = `repeat(${cols},1fr)`;
    boardDiv.style.gridTemplateRows = `repeat(${rows},1fr)`;
    for(let r=0; r<rows; r++) for(let c=0; c<cols; c++) {
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.dataset.r = r;
        cell.dataset.c = c;
        cell.addEventListener('click', cellClick);
        cell.addEventListener('contextmenu', cellFlag);
        boardDiv.appendChild(cell);
    }
}
function placeMines(safeR, safeC) {
    let placed = 0;
    let safeCells = new Set();
    for(let dr=-1; dr<=1; dr++) for(let dc=-1; dc<=1; dc++)
        if (valid(safeR+dr, safeC+dc)) safeCells.add(`${safeR+dr},${safeC+dc}`);
    while (placed < mines) {
        let r = Math.floor(Math.random() * rows), c = Math.floor(Math.random() * cols);
        if (board[r][c] === 'M') continue;
        if (safeCells.has(`${r},${c}`)) continue;
        board[r][c] = 'M';
        placed++;
    }
    for(let r=0; r<rows; r++) for(let c=0; c<cols; c++) {
        if (board[r][c]=='M') continue;
        let cnt = 0;
        for(let dr=-1; dr<=1; dr++) for(let dc=-1; dc<=1; dc++)
            if (valid(r+dr,c+dc) && board[r+dr][c+dc]=='M') cnt++;
        board[r][c] = cnt;
    }
}
function cellClick(e) {
    e.preventDefault();
    if (gameOver) return;
    const r = +this.dataset.r, c = +this.dataset.c;
    if (!started) { placeMines(r, c); started = true; }
    if (flagged[r][c] || revealed[r][c]) return;
    const hitMine = reveal(r, c);
    if (!hitMine) checkWin();
}
function cellFlag(e) {
    e.preventDefault();
    if (gameOver) return;
    const r = +this.dataset.r, c = +this.dataset.c;
    if (revealed[r][c]) return;
    flagged[r][c] = !flagged[r][c];
    updateCell(r, c);
    let flagsUsed = flagged.flat().filter(Boolean).length;
    document.getElementById('mine-count').textContent = `ðŸ’£ ${mines - flagsUsed}`;
    checkWin();
}
function reveal(r, c) {
    if (!valid(r, c) || flagged[r][c] || revealed[r][c]) return false;
    revealed[r][c] = true;
    updateCell(r, c);
    if (board[r][c] === 'M') {
        explodedCell = [r, c];
        endGame(false, r, c);
        return true;
    }
    if (board[r][c] === 0) {
        for(let dr=-1; dr<=1; dr++) for(let dc=-1; dc<=1; dc++)
            if (dr!==0||dc!==0) reveal(r+dr, c+dc);
    }
    return false;
}
function updateCell(r, c) {
    const i = r*cols+c;
    const btn = document.getElementsByClassName('cell')[i];
    btn.disabled = revealed[r][c] || gameOver;
    btn.className = 'cell';
    if (flagged[r][c] && !revealed[r][c]) {
        btn.classList.add('flagged');
        btn.textContent = "ðŸš©";
        return;
    }
    if (revealed[r][c]) {
        btn.classList.add('revealed');
        if (board[r][c]=='M') {
            btn.classList.add('mine');
            btn.textContent = "ðŸ’£";
            if (explodedCell && explodedCell[0] === r && explodedCell[1] === c && gameOver) {
                btn.classList.add('exploded');
            }
        } else if (board[r][c]>0) {
            btn.textContent = board[r][c];
            btn.classList.add('num' + board[r][c]);
        }
    }
}
function valid(r, c) { return r>=0 && c>=0 && r<rows && c<cols; }
function endGame(won, explodedR=null, explodedC=null) {
    gameOver = true;
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++) {
        if (revealed[r][c] || (won && board[r][c] != 'M')) continue;
        flagged[r][c] = (board[r][c]=='M');
        revealed[r][c] = true;
        updateCell(r, c);
    }
    if (!won && explodedR!=null && explodedC!=null) {
        updateCell(explodedR, explodedC);
    }
    document.getElementById('status').innerHTML = won
        ? '<span style="color:#27ae60;font-weight:600;">ðŸŽ‰ Congratulations, you cleared the board!</span>'
        : '<span style="color:#e2381a;font-weight:600;">Oh you stepped on mine</span>';
}
function checkWin() {
    if (gameOver) return;
    let win = true;
    for(let r=0;r<rows;r++) for(let c=0;c<cols;c++)
        if (board[r][c]!='M' && !revealed[r][c]) win = false;
    if (win) endGame(true);
}
window.newGame = newGame;
newGame();
// Theme toggle (copy-paste between all your pages!)
(function() {
    function getPreferredTheme() {
        const stored = localStorage.getItem('theme');
        if (stored) return stored;
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        document.getElementById('theme-toggle').innerHTML = theme === "dark" ? "ðŸŒž" : "ðŸŒ™";
        document.getElementById('theme-toggle').setAttribute('aria-label', theme === "dark" ? "Switch to light theme" : "Switch to dark theme");
    }
    document.addEventListener('DOMContentLoaded', function() {
        const button = document.getElementById('theme-toggle');
        if (!button) return;
        let curTheme = getPreferredTheme();
        setTheme(curTheme);
        button.onclick = function() {
            curTheme = (curTheme === "dark" ? "light" : "dark");
            setTheme(curTheme);
        };
    });
})();
</script>
</body>
</html>
